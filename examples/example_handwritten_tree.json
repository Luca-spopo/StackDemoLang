{
    "macros" :
    [
        {
            "name": "average_of_2",
            "description": "pop 2 numbers from the stack, push their average back to the stack",
            "contracts":
            [
                "I promise to pop 2 elements (the numbers to average) and push 1 element (their average) on the stack",
                "I promise to preserve the value of all registers except: R0, R1"
            ],
            "body": [
                {"command": "pop_to", "register": "R0", "informal_name" : "number_to_average_1"},
                {"command": "pop_to", "register": "R1", "informal_name" : "number_to_average_2"},

                {"command": "push_from", "register": "R1", "informal_name" : "number_to_add_1"},
                {"command": "push_from", "register": "R0", "informal_name" : "number_to_add_2"},
                {"command": "add"},
                {"command": "pop_to", "register": "R0", "informal_name": "sum"},

                {"command": "push_from", "register": "R0", "informal_name" : "sum"},
                {"command": "push", "value": 2, "informal_name" : "diviser"},
                {"command": "divide"},
                {"command": "pop_to", "register": "R0", "informal_name": "average"},

                {"command": "push_from", "register": "R0", "informal_name": "average"}
            ]
        },
        {
            "name": "sum_of_3",
            "description": "pop 3 elements from the stack, push their sum back to the stack",
            "contract_about_stack": "I promise to pop 3 elements (the numbers to sum) and push 1 element (their sum)",
            "body": [
                ["pop_to", "R0", "number_to_sum_1"],
                ["pop_to", "R1", "number_to_sum_2"],
                ["pop_to", "R2", "number_to_sum_3"],

                ["push_from", "R0", "number_to_add_1"],
                ["push_from", "R1", "number_to_add_2"],
                ["add"],
                ["pop_to", "R0", "sum_of_first_two"],

                ["push_from", "R0", "sum_of_first_two"],
                ["push_from", "R2", "number_to_add_3"],
                ["add"],
                ["pop_to", "R0", "sum_of_all_three"],

                ["push_from", "R0", "sum"]
            ]
        },
        {
            "name": "average_of_3",
            "description": "pop 3 elements from the stack, push their average back to the stack",
            "contract_about_stack": "I promise to pop 3 elements (the numbers to average) and push 1 element (their average)",
            "body": [
                ["pop_to", "num1"],
                ["pop_to", "num2"],
                ["pop_to", "num3"],

                ["push_from", "num1"],
                ["push_from", "num2"],
                ["push_from", "num3"],
                ["inline sum_of_3"],
                ["pop_to", "sum"],

                ["push_from", "sum"],
                ["push", 3],
                ["divide"],
                ["pop_to", "average"],
    
                ["push_from", "average"]
            ]
        }
    ],
    "procedures" :
    [
        {
            "name": "average_of_2",
            "description": "pop 2 numbers from the stack, push their average back to the stack",
            "contract_about_stack": "I promise to pop 3 elements and push 1 element",
            "body": [
                ["pop_to", "num1"],
                ["pop_to", "num2"],

                ["push_from", "num1"],
                ["push_from", "num2"],
                ["add"],
                ["pop_to", "sum"],

                ["push_from", "sum"],
                ["push", 2],
                ["divide"],
                ["pop_to", "average"],

                ["pop_to", "return_address"],
                ["push_from", "average"],
                ["jump_to", "return_address"]
            ]
        },
        {
            "name": "sum_of_3",
            "description": "pop 3 elements from the stack, push their sum back to the stack",
            "contract_about_stack": "I promise to pop 4 elements and push 1 element",
            "body": [
                ["pop_to", "num1"],
                ["pop_to", "num2"],
                ["pop_to", "num3"],

                ["push_from", "num1"],
                ["push_from", "num2"],
                ["add"],
                ["pop_to", "sum"],

                ["push_from", "sum"],
                ["push_from", "num3"],
                ["add"],
                ["pop_to", "sum"],

                ["pop_to", "return_address"],
                ["push_from", "sum"],
                ["jump_to", "return_address"]
            ]
        },
        {
            "name": "average_of_3",
            "description": "pop 3 elements from the stack, push their average back to the stack",
            "contract_about_stack": "I promise to pop 4 elements and push 1 element",
            "body": [
                ["pop_to", "num1"],
                ["pop_to", "num2"],
                ["pop_to", "num3"],

                ["push", 134],
                ["push_from", "num1"],
                ["push_from", "num2"],
                ["push_from", "num3"],
                ["call sum_of_3"],
                ["pop_to", "sum"],

                ["push_from", "sum"],
                ["push", 3],
                ["divide"],
                ["pop_to", "average"],
    
                ["pop_to", "return_address"],
                ["push_from", "average"],
                ["jump_to", "return_address"]
            ]
        }
    ]
}
